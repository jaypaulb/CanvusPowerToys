class WorkspaceClient{constructor(){this.eventSource=null,this.listeners=new Map,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=3e3,this.isConnected=!1}connect(e){this.eventSource&&this.disconnect();const t=`${e}/api/subscribe-workspace`;this.eventSource=new EventSource(t),this.eventSource.onopen=()=>{this.isConnected=!0,this.reconnectAttempts=0,this.emit("connected")},this.eventSource.addEventListener("canvas_update",e=>{try{const t=JSON.parse(e.data);this.emit("canvas_update",t)}catch(e){(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&console.error("Error parsing canvas update:",e)}}),this.eventSource.onerror=t=>{this.isConnected=!1,this.emit("error",t),this.eventSource.readyState===EventSource.CLOSED&&this.handleReconnect(e)}}disconnect(){this.eventSource&&(this.eventSource.close(),this.eventSource=null,this.isConnected=!1,this.emit("disconnected"))}handleReconnect(e){if(this.reconnectAttempts>=this.maxReconnectAttempts){this.emit("max_reconnect_attempts");return}this.reconnectAttempts++,this.emit("reconnecting",this.reconnectAttempts),setTimeout(()=>{this.connect(e)},this.reconnectDelay)}on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}off(e,t){if(this.listeners.has(e)){const n=this.listeners.get(e),s=n.indexOf(t);s>-1&&n.splice(s,1)}}emit(e,t){this.listeners.has(e)&&this.listeners.get(e).forEach(n=>{try{n(t)}catch(t){(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&console.error(`Error in event listener for ${e}:`,t)}})}}typeof module!="undefined"&&module.exports&&(module.exports=WorkspaceClient)