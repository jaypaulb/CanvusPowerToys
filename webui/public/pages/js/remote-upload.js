document.addEventListener("DOMContentLoaded",()=>{initTeamButtonStyles(),initCreateTargets(),initTestTeamButtons(),initUserManagement()});function initTeamButtonStyles(){const t=document.querySelectorAll("[data-test-team]"),e={1:"rgb(255, 0, 0)",2:"rgb(255, 127, 0)",3:"rgb(255, 255, 0)",4:"rgb(0, 255, 0)",5:"rgb(0, 0, 255)",6:"rgb(75, 0, 130)",7:"rgb(139, 0, 255)"},n={1:"rgb(255, 255, 255)",2:"rgb(0, 0, 0)",3:"rgb(0, 0, 0)",4:"rgb(0, 0, 0)",5:"rgb(255, 255, 255)",6:"rgb(255, 255, 255)",7:"rgb(255, 255, 255)"};t.forEach(t=>{const s=parseInt(t.getAttribute("data-test-team"));s&&e[s]&&(t.style.width="120px",t.style.height="40px",t.style.flexShrink="0",t.style.minWidth="120px",t.style.maxWidth="120px",t.style.backgroundColor=e[s],t.style.color=n[s])})}function initCreateTargets(){const t=document.getElementById("createTargetsBtn"),n=document.getElementById("deleteTargetsBtn"),e=document.getElementById("targetsMessage");t&&t.addEventListener("click",async()=>{try{const n=await fetch("/api/admin/create-targets",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await n.json();n.ok&&t.success?displayMessage(e,t.message||"Target notes created successfully","success"):displayMessage(e,t.error||"Failed to create target notes","error")}catch(t){console.error("Error creating targets:",t),displayMessage(e,"An error occurred while creating targets","error")}}),n&&n.addEventListener("click",async()=>{if(!confirm("Are you sure you want to delete all target notes?"))return;try{const n=await fetch("/api/admin/delete-targets",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await n.json();n.ok&&t.success?displayMessage(e,t.message||"Target notes deleted successfully","success"):displayMessage(e,t.error||"Failed to delete target notes","error")}catch(t){console.error("Error deleting targets:",t),displayMessage(e,"An error occurred while deleting targets","error")}})}function initTestTeamButtons(){const t=document.querySelectorAll("[data-test-team]"),e=document.getElementById("testTeamMessage");t.forEach(t=>{t.addEventListener("click",async()=>{const n=parseInt(t.getAttribute("data-test-team"));try{const t=await fetch("/api/admin/test-team",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({team:n,text:`Test note from Admin to Team ${n}`})}),s=await t.json();t.ok&&s.success?displayMessage(e,`Test note sent to Team ${n} successfully`,"success"):displayMessage(e,s.error||`Failed to send test note to Team ${n}`,"error")}catch(t){console.error(`Error sending test note to Team ${n}:`,t),displayMessage(e,`An error occurred while sending test note to Team ${n}`,"error")}})})}function initUserManagement(){const n=document.getElementById("listUsersBtn"),s=document.getElementById("deleteUsersBtn"),o=document.getElementById("userListTable"),e=document.getElementById("userListMessage"),t=o?o.querySelector("tbody"):null;n&&n.addEventListener("click",async()=>{try{const s=await fetch("/api/admin/list-users",{method:"GET",headers:{"Content-Type":"application/json"}}),n=await s.json();s.ok&&n.success&&n.users?displayUserList(n.users,t,e):displayMessage(e,n.error||"Failed to list users","error")}catch(t){console.error("Error listing users:",t),displayMessage(e,"An error occurred while listing users","error")}}),s&&s.addEventListener("click",async()=>{if(!confirm("Are you sure you want to delete all users?"))return;try{const s=await fetch("/api/admin/delete-users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({all:!0})}),n=await s.json();s.ok&&n.success?(displayMessage(e,n.message||"Users deleted successfully","success"),t&&(t.innerHTML="")):displayMessage(e,n.error||"Failed to delete users","error")}catch(t){console.error("Error deleting users:",t),displayMessage(e,"An error occurred while deleting users","error")}})}function displayUserList(e,t,n){if(!t)return;if(!e||e.length===0){t.innerHTML="",n&&(n.textContent="No users to display.",n.style.display="block");return}n&&(n.style.display="none"),t.innerHTML=e.map(e=>`
    <tr>
      <td>Team ${e.team}</td>
      <td>${e.name}</td>
      <td>${e.color?e.color.toUpperCase():"N/A"}</td>
    </tr>
  `).join("")}function displayMessage(e,t,n){if(!e){console.log(`[${n}] ${t}`);return}e.textContent=t,e.className=`message ${n} mt-md`,e.style.display="block",setTimeout(()=>{e.style.display="none"},5e3)}