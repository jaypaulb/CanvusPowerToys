document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("message");function e(e,n){if(!t)return;t.textContent=e,t.className=`message ${n}`,t.style.display="block"}function o(){if(!t)return;t.textContent="",t.className="message",t.style.display="none"}function n(e){const t=document.querySelectorAll("button");t.forEach(t=>t.disabled=e)}async function s(){console.log("Fetching zones...");try{const n=await fetch("/get-zones",{method:"GET",headers:{"Cache-Control":"no-cache"}}),t=await n.json();if(console.log("Data received from /get-zones:",t),t.success){const n=document.getElementById("subZone");if(!n)return;if(n.innerHTML='<option value="">-- Select Zone --</option>',Array.isArray(t.zones)){const e=[...t.zones].sort((e,t)=>{const n=(e.anchor_name||"").toLowerCase(),s=(t.anchor_name||"").toLowerCase();return n.localeCompare(s,0[0],{numeric:!0})});e.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.anchor_name||`Zone ${e.id}`,n.appendChild(t)}),console.log("Dropdown updated with sorted zones.")}else console.error("data.zones is not an array:",t.zones),e("Unexpected data format received.","error")}else e("Failed to fetch zones.","error")}catch(t){console.error("Error fetching zones:",t),e("Error fetching zones.","error")}}window.addEventListener("load",()=>{s()});async function i(){o(),n(!0);const t=parseInt(document.getElementById("gridSize").value),i=document.getElementById("gridPattern").value,a=document.getElementById("subZone").value,r=document.getElementById("subZoneArray").value;e("Creating zones, please wait...","loading");try{const o=await fetch("/create-zones",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({gridSize:t,gridPattern:i,subZoneId:a,subZoneArray:r})}),n=await o.json();console.log("Response from /create-zones:",n),n.success?(e(n.message,"success"),console.log("Calling fetchAndPopulateSubZones after successful zone creation."),await s(),console.log("fetchAndPopulateSubZones completed.")):e(n.error||"Failed to create zones.","error")}catch(t){console.error("Error:",t),e("An error occurred while creating zones.","error")}finally{n(!1)}}async function l(){o(),n(!0),e("Deleting zones, please wait...","loading");try{const n=await fetch("/delete-zones",{method:"DELETE",headers:{"Content-Type":"application/json"}}),t=await n.json();console.log("Response from /delete-zones:",t),t.success?(e(t.message,"success"),console.log("Calling fetchAndPopulateSubZones after successful zone deletion."),await s(),console.log("fetchAndPopulateSubZones completed.")):e(t.error||"Failed to delete zones.","error")}catch(t){console.error("Error:",t),e("An error occurred while deleting zones.","error")}finally{n(!1)}}const a=document.getElementById("createZones"),r=document.getElementById("deleteZones"),c=document.getElementById("createSubZones");a&&a.addEventListener("click",i),r&&r.addEventListener("click",l),c&&c.addEventListener("click",i)})